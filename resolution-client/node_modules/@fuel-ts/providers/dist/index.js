"use strict";var vt=Object.create;var V=Object.defineProperty;var Wt=Object.getOwnPropertyDescriptor;var zt=Object.getOwnPropertyNames;var Kt=Object.getPrototypeOf,Xt=Object.prototype.hasOwnProperty;var Zt=(r,t)=>{for(var e in t)V(r,e,{get:t[e],enumerable:!0})},bt=(r,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of zt(t))!Xt.call(r,s)&&s!==e&&V(r,s,{get:()=>t[s],enumerable:!(a=Wt(t,s))||a.enumerable});return r};var et=(r,t,e)=>(e=r!=null?vt(Kt(r)):{},bt(t||!r||!r.__esModule?V(e,"default",{value:r,enumerable:!0}):e,r)),Jt=r=>bt(V({},"__esModule",{value:!0}),r);var Ve={};Zt(Ve,{ChangeOutputCollisionError:()=>K,CoinStatus:()=>st,CreateTransactionRequest:()=>U,MessageStatus:()=>nt,NoWitnessAtIndexError:()=>X,NoWitnessByOwnerError:()=>Z,Provider:()=>N,ScriptTransactionRequest:()=>$,TransactionResponse:()=>E,TransactionType:()=>p.TransactionType,buildBlockExplorerUrl:()=>Oe,calculatePriceWithFactor:()=>W,calculateTransactionFee:()=>_,coinQuantityfy:()=>A,getDecodedLogs:()=>Ne,getGasUsedFromReceipts:()=>Pt,getReceiptsWithMissingData:()=>lt,inputify:()=>ct,isCoin:()=>B,isMessage:()=>Me,isRawCoin:()=>it,isRawMessage:()=>_e,normalizeJSON:()=>mt,outputify:()=>ut,returnZeroScript:()=>St,sleep:()=>dt,transactionRequestify:()=>P,withdrawScript:()=>De});module.exports=Jt(Ve);var Gt=require("@ethersproject/bytes"),at=require("@fuel-ts/address/configs"),rt=require("@fuel-ts/math"),A=r=>{var s,n,i,l;let t,e,a;return Array.isArray(r)?(e=r[0],t=(s=r[1])!=null?s:at.NativeAssetId,a=(n=r[2])!=null?n:void 0):(e=r.amount,t=(i=r.assetId)!=null?i:at.NativeAssetId,a=(l=r.max)!=null?l:void 0),{assetId:(0,Gt.hexlify)(t),amount:(0,rt.bn)(e),max:a?(0,rt.bn)(a):void 0}};var c=et(require("graphql-tag")),st=(e=>(e.Spent="SPENT",e.Unspent="UNSPENT",e))(st||{}),nt=(e=>(e.Spent="SPENT",e.Unspent="UNSPENT",e))(nt||{});var w=c.default`
  fragment transactionFragment on Transaction {
    id
    rawPayload
    gasPrice
    status {
      type: __typename
      ... on SubmittedStatus {
        time
      }
      ... on SuccessStatus {
        block {
          id
        }
        time
        programState {
          returnType
          data
        }
      }
      ... on FailureStatus {
        block {
          id
        }
        time
        reason
      }
    }
  }
`,Tt=c.default`
  fragment receiptFragment on Receipt {
    data
    rawPayload
  }
`,ot=c.default`
  fragment coinFragment on Coin {
    utxoId
    owner
    amount
    assetId
    maturity
    coinStatus: status
    blockCreated
  }
`,Rt=c.default`
  fragment messageFragment on Message {
    amount
    sender
    recipient
    data
    nonce
    messageStatus: status
    daHeight
  }
`,Yt=c.default`
  fragment messageProofFragment on MessageProof {
    proofSet
    proofIndex
    sender
    recipient
    nonce
    amount
    data
    signature
    header {
      id
      daHeight
      transactionsCount
      outputMessagesCount
      transactionsRoot
      outputMessagesRoot
      height
      prevRoot
      time
      applicationHash
    }
  }
`,Ct=c.default`
  fragment balanceFragment on Balance {
    owner
    amount
    assetId
  }
`,jt=c.default`
  fragment consensusParametersFragment on ConsensusParameters {
    contractMaxSize
    maxInputs
    maxOutputs
    maxWitnesses
    maxGasPerTx
    maxScriptLength
    maxScriptDataLength
    maxStorageSlots
    maxPredicateLength
    maxPredicateDataLength
    gasPriceFactor
    gasPerByte
    maxMessageDataLength
  }
`,H=c.default`
  fragment blockFragment on Block {
    id
    header {
      height
      time
    }
    transactions {
      id
    }
  }
`,te=c.default`
  fragment chainInfoFragment on ChainInfo {
    name
    baseChainHeight
    peerCount
    consensusParameters {
      ...consensusParametersFragment
    }
    latestBlock {
      ...blockFragment
    }
  }
  ${jt}
  ${H}
`,ee=c.default`
  fragment contractBalanceFragment on ContractBalance {
    contract
    amount
    assetId
  }
`,ae=c.default`
  query getVersion {
    nodeInfo {
      nodeVersion
    }
  }
`,re=c.default`
  query getInfo {
    nodeInfo {
      nodeVersion
      minGasPrice
    }
  }
`,se=c.default`
  query getChain {
    chain {
      ...chainInfoFragment
    }
  }
  ${te}
`,ne=c.default`
  query getTransaction($transactionId: TransactionId!) {
    transaction(id: $transactionId) {
      ...transactionFragment
    }
  }
  ${w}
`,oe=c.default`
  query getTransactionWithReceipts($transactionId: TransactionId!) {
    transaction(id: $transactionId) {
      ...transactionFragment
      receipts {
        ...receiptFragment
      }
    }
  }
  ${w}
  ${Tt}
`,ie=c.default`
  query getTransactions($after: String, $before: String, $first: Int, $last: Int) {
    transactions(after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...transactionFragment
        }
      }
    }
  }
  ${w}
`,ce=c.default`
  query getTransactionsByOwner(
    $owner: Address!
    $after: String
    $before: String
    $first: Int
    $last: Int
  ) {
    transactionsByOwner(owner: $owner, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...transactionFragment
        }
      }
    }
  }
  ${w}
`,ue=c.default`
  query getBlock($blockId: BlockId, $blockHeight: U64) {
    block(id: $blockId, height: $blockHeight) {
      ...blockFragment
    }
  }
  ${H}
`,pe=c.default`
  query getBlockWithTransactions($blockId: BlockId, $blockHeight: U64) {
    block(id: $blockId, height: $blockHeight) {
      ...blockFragment
      transactions {
        ...transactionFragment
      }
    }
  }
  ${H}
  ${w}
`,le=c.default`
  query getBlocks($after: String, $before: String, $first: Int, $last: Int) {
    blocks(after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...blockFragment
        }
      }
    }
  }
  ${H}
`,ye=c.default`
  query getCoin($coinId: UtxoId!) {
    coin(utxoId: $coinId) {
      ...coinFragment
    }
  }
  ${ot}
`,ge=c.default`
  query getCoins(
    $filter: CoinFilterInput!
    $after: String
    $before: String
    $first: Int
    $last: Int
  ) {
    coins(filter: $filter, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...coinFragment
        }
      }
    }
  }
  ${ot}
`,me=c.default`
  query getResourcesToSpend(
    $owner: Address!
    $queryPerAsset: [SpendQueryElementInput!]!
    $excludedIds: ExcludeInput
  ) {
    resourcesToSpend(owner: $owner, queryPerAsset: $queryPerAsset, excludedIds: $excludedIds) {
      ...coinFragment
      ...messageFragment
    }
  }
  ${ot}
  ${Rt}
`,de=c.default`
  query getContract($contractId: ContractId!) {
    contract(id: $contractId) {
      bytecode
      id
    }
  }
`,Se=c.default`
  query getContractBalance($contract: ContractId!, $asset: AssetId!) {
    contractBalance(contract: $contract, asset: $asset) {
      ...contractBalanceFragment
    }
  }
  ${ee}
`,xe=c.default`
  query getBalance($owner: Address!, $assetId: AssetId!) {
    balance(owner: $owner, assetId: $assetId) {
      ...balanceFragment
    }
  }
  ${Ct}
`,fe=c.default`
  query getBalances(
    $filter: BalanceFilterInput!
    $after: String
    $before: String
    $first: Int
    $last: Int
  ) {
    balances(filter: $filter, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...balanceFragment
        }
      }
    }
  }
  ${Ct}
`,Ie=c.default`
  query getMessages($owner: Address!, $after: String, $before: String, $first: Int, $last: Int) {
    messages(owner: $owner, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...messageFragment
        }
      }
    }
  }
  ${Rt}
`,qe=c.default`
  query getMessageProof($transactionId: TransactionId!, $messageId: MessageId!) {
    messageProof(transactionId: $transactionId, messageId: $messageId) {
      ...messageProofFragment
    }
  }
  ${Yt}
`,he=c.default`
  mutation dryRun($encodedTransaction: HexString!, $utxoValidation: Boolean) {
    dryRun(tx: $encodedTransaction, utxoValidation: $utxoValidation) {
      ...receiptFragment
    }
  }
  ${Tt}
`,be=c.default`
  mutation submit($encodedTransaction: HexString!) {
    submit(tx: $encodedTransaction) {
      id
    }
  }
`,Ge=c.default`
  mutation startSession {
    startSession
  }
`,Te=c.default`
  mutation endSession($sessionId: ID!) {
    endSession(id: $sessionId)
  }
`,Re=c.default`
  mutation execute($sessionId: ID!, $op: String!) {
    execute(id: $sessionId, op: $op)
  }
`,Ce=c.default`
  mutation reset($sessionId: ID!) {
    reset(id: $sessionId)
  }
`,Be=(r,t,e)=>r();function Bt(r,t=Be){return{getVersion(e,a){return t(s=>r.request(ae,e,{...a,...s}),"getVersion","query")},getInfo(e,a){return t(s=>r.request(re,e,{...a,...s}),"getInfo","query")},getChain(e,a){return t(s=>r.request(se,e,{...a,...s}),"getChain","query")},getTransaction(e,a){return t(s=>r.request(ne,e,{...a,...s}),"getTransaction","query")},getTransactionWithReceipts(e,a){return t(s=>r.request(oe,e,{...a,...s}),"getTransactionWithReceipts","query")},getTransactions(e,a){return t(s=>r.request(ie,e,{...a,...s}),"getTransactions","query")},getTransactionsByOwner(e,a){return t(s=>r.request(ce,e,{...a,...s}),"getTransactionsByOwner","query")},getBlock(e,a){return t(s=>r.request(ue,e,{...a,...s}),"getBlock","query")},getBlockWithTransactions(e,a){return t(s=>r.request(pe,e,{...a,...s}),"getBlockWithTransactions","query")},getBlocks(e,a){return t(s=>r.request(le,e,{...a,...s}),"getBlocks","query")},getCoin(e,a){return t(s=>r.request(ye,e,{...a,...s}),"getCoin","query")},getCoins(e,a){return t(s=>r.request(ge,e,{...a,...s}),"getCoins","query")},getResourcesToSpend(e,a){return t(s=>r.request(me,e,{...a,...s}),"getResourcesToSpend","query")},getContract(e,a){return t(s=>r.request(de,e,{...a,...s}),"getContract","query")},getContractBalance(e,a){return t(s=>r.request(Se,e,{...a,...s}),"getContractBalance","query")},getBalance(e,a){return t(s=>r.request(xe,e,{...a,...s}),"getBalance","query")},getBalances(e,a){return t(s=>r.request(fe,e,{...a,...s}),"getBalances","query")},getMessages(e,a){return t(s=>r.request(Ie,e,{...a,...s}),"getMessages","query")},getMessageProof(e,a){return t(s=>r.request(qe,e,{...a,...s}),"getMessageProof","query")},dryRun(e,a){return t(s=>r.request(he,e,{...a,...s}),"dryRun","mutation")},submit(e,a){return t(s=>r.request(be,e,{...a,...s}),"submit","mutation")},startSession(e,a){return t(s=>r.request(Ge,e,{...a,...s}),"startSession","mutation")},endSession(e,a){return t(s=>r.request(Te,e,{...a,...s}),"endSession","mutation")},execute(e,a){return t(s=>r.request(Re,e,{...a,...s}),"execute","mutation")},reset(e,a){return t(s=>r.request(Ce,e,{...a,...s}),"reset","mutation")}}}var S=require("@ethersproject/bytes"),I=require("@fuel-ts/address"),o=require("@fuel-ts/math"),f=require("@fuel-ts/transactions"),Qt=require("@fuel-ts/transactions/configs"),Ft=require("graphql-request"),$t=et(require("lodash.clonedeep"));var it=r=>"utxoId"in r,_e=r=>"recipient"in r,B=r=>"id"in r,Me=r=>"recipient"in r;var y=require("@ethersproject/bytes"),v=require("@fuel-ts/address/configs"),q=require("@fuel-ts/math"),T=require("@fuel-ts/transactions"),ct=r=>{var t,e,a,s,n;switch(r.type){case T.InputType.Coin:{let i=(0,y.arrayify)((t=r.predicate)!=null?t:"0x"),l=(0,y.arrayify)((e=r.predicateData)!=null?e:"0x");return{type:T.InputType.Coin,utxoID:{transactionId:(0,y.hexlify)((0,y.arrayify)(r.id).slice(0,32)),outputIndex:(0,y.arrayify)(r.id)[32]},owner:(0,y.hexlify)(r.owner),amount:(0,q.bn)(r.amount),assetId:(0,y.hexlify)(r.assetId),txPointer:{blockHeight:(0,q.toNumber)((0,y.arrayify)(r.txPointer).slice(0,8)),txIndex:(0,q.toNumber)((0,y.arrayify)(r.txPointer).slice(8,16))},witnessIndex:r.witnessIndex,maturity:(a=r.maturity)!=null?a:0,predicateLength:i.length,predicateDataLength:l.length,predicate:(0,y.hexlify)(i),predicateData:(0,y.hexlify)(l)}}case T.InputType.Contract:return{type:T.InputType.Contract,utxoID:{transactionId:v.ZeroBytes32,outputIndex:0},balanceRoot:v.ZeroBytes32,stateRoot:v.ZeroBytes32,txPointer:{blockHeight:(0,q.toNumber)((0,y.arrayify)(r.txPointer).slice(0,8)),txIndex:(0,q.toNumber)((0,y.arrayify)(r.txPointer).slice(8,16))},contractID:(0,y.hexlify)(r.contractId)};case T.InputType.Message:{let i=(0,y.arrayify)((s=r.predicate)!=null?s:"0x"),l=(0,y.arrayify)((n=r.predicateData)!=null?n:"0x");return{type:T.InputType.Message,sender:(0,y.hexlify)(r.sender),recipient:(0,y.hexlify)(r.recipient),amount:(0,q.bn)(r.amount),nonce:(0,q.bn)(r.nonce),witnessIndex:r.witnessIndex,dataLength:r.data.length,predicateLength:i.length,predicateDataLength:l.length,data:(0,y.hexlify)(r.data),predicate:(0,y.hexlify)(i),predicateData:(0,y.hexlify)(l)}}default:throw new Error("Invalid Input type")}};var h=require("@ethersproject/bytes"),O=require("@fuel-ts/address/configs"),L=require("@fuel-ts/math"),x=require("@fuel-ts/transactions"),ut=r=>{switch(r.type){case x.OutputType.Coin:return{type:x.OutputType.Coin,to:(0,h.hexlify)(r.to),amount:(0,L.bn)(r.amount),assetId:(0,h.hexlify)(r.assetId)};case x.OutputType.Contract:return{type:x.OutputType.Contract,inputIndex:r.inputIndex,balanceRoot:O.ZeroBytes32,stateRoot:O.ZeroBytes32};case x.OutputType.Message:return{type:x.OutputType.Message,recipient:(0,h.hexlify)(r.recipient),amount:(0,L.bn)(r.amount)};case x.OutputType.Change:return{type:x.OutputType.Change,to:(0,h.hexlify)(r.to),amount:(0,L.bn)(0),assetId:(0,h.hexlify)(r.assetId)};case x.OutputType.Variable:return{type:x.OutputType.Variable,to:O.ZeroBytes32,amount:(0,L.bn)(0),assetId:O.ZeroBytes32};case x.OutputType.ContractCreated:return{type:x.OutputType.ContractCreated,contractId:(0,h.hexlify)(r.contractId),stateRoot:(0,h.hexlify)(r.stateRoot)};default:throw new Error("Invalid Output type")}};var m=require("@ethersproject/bytes"),M=require("@fuel-ts/address"),b=require("@fuel-ts/address/configs"),F=require("@fuel-ts/math"),p=require("@fuel-ts/transactions"),Lt=require("@fuel-ts/transactions/configs");var pt=require("@fuel-ts/transactions"),_t=require("@fuel-ts/transactions/configs"),Pe=r=>r.type===pt.ReceiptType.Revert&&r.val.toString("hex")===_t.FAILED_TRANSFER_TO_ADDRESS_SIGNAL,ke=r=>r.type===pt.ReceiptType.Panic&&r.contractId!=="0x0000000000000000000000000000000000000000000000000000000000000000",lt=r=>r.reduce((t,e)=>(Pe(e)&&t.missingOutputVariables.push(e),ke(e)&&t.missingOutputContractIds.push(e),t),{missingOutputVariables:[],missingOutputContractIds:[]});var D=require("@fuel-ts/math"),yt=require("@fuel-ts/transactions"),Mt=require("@fuel-ts/transactions/configs"),W=(r,t,e)=>(0,D.bn)(Math.ceil(r.toNumber()/e.toNumber())*t.toNumber()),Pt=r=>{let t=r.find(e=>e.type===yt.ReceiptType.ScriptResult);return t&&t.type===yt.ReceiptType.ScriptResult?t.gasUsed:(0,D.bn)(0)},_=({receipts:r,gasPrice:t,margin:e})=>{let a=(0,D.multiply)(Pt(r),e||1),s=W(a,t,Mt.GAS_PRICE_FACTOR);return{gasUsed:a,fee:s}};var Ae="https://fuellabs.github.io/block-explorer-v2",we=(r,t)=>`${{address:"address",txId:"transaction",blockNumber:"block"}[r]||r}/${t}`,Oe=(r={})=>{let{blockExplorerUrl:t,path:e,providerUrl:a,address:s,txId:n,blockNumber:i}=r,l=t||Ae,u=[{key:"address",value:s},{key:"txId",value:n},{key:"blockNumber",value:i}],d=u.filter(G=>!!G.value).map(({key:G,value:tt})=>({key:G,value:tt})),C=d.length>0;if(d.length>1)throw new Error(`Only one of the following can be passed in to buildBlockExplorerUrl: ${u.map(G=>G.key).join(", ")}`);if(e&&d.length>0){let G=u.map(({key:tt})=>tt).join(", ");throw new Error(`You cannot pass in a path to buildBlockExplorerUrl along with any of the following: ${G}`)}let Et=C?we(d[0].key,d[0].value):"",j=/^\/|\/$/gm,Nt=e?e.replace(j,""):Et,qt=l.replace(j,""),k=a==null?void 0:a.replace(j,""),ht=k?encodeURIComponent(k):void 0,Vt=qt.match(/^https?:\/\//)?"":"https://",Ht=k!=null&&k.match(/^https?:\/\//)?"":"https://";return`${Vt}${qt}/${Nt}${ht?`?providerUrl=${Ht}${ht}`:""}`};var kt=require("@ethersproject/bytes"),At=et(require("lodash.clonedeep"));function gt(r){return Object.keys(r).forEach(t=>{switch(r[t].constructor.name){case"Uint8Array":r[t]=(0,kt.hexlify)(r[t]);break;case"Array":r[t]=gt(r[t]);break;case"BN":r[t]=r[t].toHex();break;case"Address":r[t]=r[t].toB256();break;case"Object":r[t]=gt(r[t]);break;default:break}}),r}function mt(r){return gt((0,At.default)(r))}function dt(r){return new Promise(t=>{setTimeout(()=>{t(!0)},r)})}var Q=require("@ethersproject/bytes"),Le=r=>{let t=new Uint8Array(32);return t.set((0,Q.arrayify)(r)),t},wt=r=>{let t,e;return Array.isArray(r)?(t=r[0],e=r[1]):(t=r.key,e=r.value),{key:(0,Q.hexlify)(t),value:(0,Q.hexlify)(Le(e))}};var z=require("@ethersproject/bytes"),Ot=r=>{let t=(0,z.arrayify)(r);return{data:(0,z.hexlify)(t),dataLength:t.length}};var St={bytes:(0,m.arrayify)("0x24000000"),encodeScriptData:()=>new Uint8Array(0)},De={bytes:(0,m.arrayify)("0x5040C0105D44C0064C40001124000000"),encodeScriptData:()=>new Uint8Array(0)},K=class extends Error{name="ChangeOutputCollisionError";message='A ChangeOutput with the same "assetId" already exists for a different "to" address'},X=class extends Error{constructor(e){super();this.index=e;this.message=`Witness at index "${e}" was not found`}name="NoWitnessAtIndexError"},Z=class extends Error{constructor(e){super();this.owner=e;this.message=`A witness for the given owner "${e}" was not found`}name="NoWitnessByOwnerError"},J=class{gasPrice;gasLimit;maturity;inputs=[];outputs=[];witnesses=[];constructor({gasPrice:t,gasLimit:e,maturity:a,inputs:s,outputs:n,witnesses:i}={}){this.gasPrice=(0,F.bn)(t!=null?t:0),this.gasLimit=(0,F.bn)(e!=null?e:0),this.maturity=a!=null?a:0,this.inputs=[...s!=null?s:[]],this.outputs=[...n!=null?n:[]],this.witnesses=[...i!=null?i:[]]}getBaseTransaction(){var s,n,i,l,u,d;let t=(n=(s=this.inputs)==null?void 0:s.map(ct))!=null?n:[],e=(l=(i=this.outputs)==null?void 0:i.map(ut))!=null?l:[],a=(d=(u=this.witnesses)==null?void 0:u.map(Ot))!=null?d:[];return{gasPrice:this.gasPrice,gasLimit:this.gasLimit,maturity:this.maturity,inputs:t,outputs:e,witnesses:a,inputsCount:t.length,outputsCount:e.length,witnessesCount:a.length}}toTransactionBytes(){return new p.TransactionCoder().encode(this.toTransaction())}pushInput(t){return this.inputs.push(t),this.inputs.length-1}pushOutput(t){return this.outputs.push(t),this.outputs.length-1}createWitness(){return this.witnesses.push("0x"),this.witnesses.length-1}updateWitnessByOwner(t,e){let a=this.getCoinInputWitnessIndexByOwner(t);typeof a=="number"&&this.updateWitness(a,e)}updateWitness(t,e){if(!this.witnesses[t])throw new X(t);this.witnesses[t]=e}getCoinInputs(){return this.inputs.filter(t=>t.type===p.InputType.Coin)}getCoinOutputs(){return this.outputs.filter(t=>t.type===p.OutputType.Coin)}getChangeOutputs(){return this.outputs.filter(t=>t.type===p.OutputType.Change)}getCoinInputWitnessIndexByOwner(t){var a,s,n,i;let e=(0,M.addressify)(t);return(i=(n=(a=this.inputs.find(l=>l.type===p.InputType.Coin&&(0,m.hexlify)(l.owner)===e.toB256()))==null?void 0:a.witnessIndex)!=null?n:(s=this.inputs.find(l=>l.type===p.InputType.Message&&(0,m.hexlify)(l.recipient)===e.toB256()))==null?void 0:s.witnessIndex)!=null?i:null}updateWitnessByCoinInputOwner(t,e){let a=this.getCoinInputWitnessIndexByOwner(t);if(!a)throw new Z((0,M.addressify)(t));this.updateWitness(a,e)}addResource(t){let e=B(t)?t.owner:t.recipient,a=B(t)?t.assetId:b.NativeAssetId,s=B(t)?p.InputType.Coin:p.InputType.Message,n=this.getCoinInputWitnessIndexByOwner(e);typeof n!="number"&&(n=this.createWitness()),this.pushInput(B(t)?{type:s,...t,owner:t.owner.toB256(),witnessIndex:n,txPointer:"0x00000000000000000000000000000000"}:{type:s,...t,sender:t.sender.toB256(),recipient:t.recipient.toB256(),witnessIndex:n,txPointer:"0x00000000000000000000000000000000"});let i=this.getChangeOutputs().find(l=>(0,m.hexlify)(l.assetId)===a);if(i&&(0,m.hexlify)(i.to)!==e.toB256())throw new K;i||this.pushOutput({type:p.OutputType.Change,to:e.toB256(),assetId:a})}addResources(t){t.forEach(e=>this.addResource(e))}addCoinOutput(t,e,a=b.NativeAssetId){this.pushOutput({type:p.OutputType.Coin,to:(0,M.addressify)(t).toB256(),amount:e,assetId:a})}addCoinOutputs(t,e){e.map(A).forEach(a=>{this.pushOutput({type:p.OutputType.Coin,to:(0,M.addressify)(t).toB256(),amount:a.amount,assetId:a.assetId})})}byteSize(){return this.toTransactionBytes().length}chargeableByteSize(){let t=this.witnesses.reduce((e,a)=>e+(0,m.arrayify)(a).length,0);return(0,F.bn)(this.toTransactionBytes().length-t)}calculateFee(){let t=W(this.gasLimit,this.gasPrice,Lt.GAS_PRICE_FACTOR);return{assetId:b.NativeAssetId,amount:t.isZero()?(0,F.bn)(1):t}}toJSON(){return mt(this)}},$=class extends J{static from(t){return t instanceof this?t:new this(t)}type=p.TransactionType.Script;script;scriptData;bytesOffset;constructor({script:t,scriptData:e,...a}={}){super(a),this.script=(0,m.arrayify)(t!=null?t:St.bytes),this.scriptData=(0,m.arrayify)(e!=null?e:St.encodeScriptData())}toTransaction(){var a,s;let t=(0,m.arrayify)((a=this.script)!=null?a:"0x"),e=(0,m.arrayify)((s=this.scriptData)!=null?s:"0x");return{type:p.TransactionType.Script,...super.getBaseTransaction(),scriptLength:t.length,scriptDataLength:e.length,receiptsRoot:b.ZeroBytes32,script:(0,m.hexlify)(t),scriptData:(0,m.hexlify)(e)}}getContractInputs(){return this.inputs.filter(t=>t.type===p.InputType.Contract)}getContractOutputs(){return this.outputs.filter(t=>t.type===p.OutputType.Contract)}getVariableOutputs(){return this.outputs.filter(t=>t.type===p.OutputType.Variable)}setScript(t,e){this.script=t.bytes,this.scriptData=t.encodeScriptData(e),this.bytesOffset===void 0&&(this.bytesOffset=this.scriptData.byteLength)}addVariableOutputs(t=1){let e=t;for(;e;)this.pushOutput({type:p.OutputType.Variable}),e-=1;return this.outputs.length-1}addMessageOutputs(t=1){let e=t;for(;e;)this.pushOutput({type:p.OutputType.Message,recipient:"0x0000000000000000000000000000000000000000000000000000000000000000",amount:0}),e-=1;return this.outputs.length-1}addContract(t){let e=(0,M.addressify)(t);if(this.getContractInputs().find(s=>s.contractId===e.toB256()))return;let a=super.pushInput({type:p.InputType.Contract,contractId:e.toB256(),txPointer:"0x00000000000000000000000000000000"});this.pushOutput({type:p.OutputType.Contract,inputIndex:a})}},U=class extends J{static from(t){return t instanceof this?t:new this(t)}type=p.TransactionType.Create;bytecodeWitnessIndex;salt;storageSlots;constructor({bytecodeWitnessIndex:t,salt:e,storageSlots:a,...s}={}){super(s),this.bytecodeWitnessIndex=t!=null?t:0,this.salt=(0,m.hexlify)(e!=null?e:b.ZeroBytes32),this.storageSlots=[...a!=null?a:[]]}toTransaction(){var s,n;let t=this.getBaseTransaction(),e=this.bytecodeWitnessIndex,a=(n=(s=this.storageSlots)==null?void 0:s.map(wt))!=null?n:[];return{type:p.TransactionType.Create,...t,bytecodeLength:t.witnesses[e].dataLength/4,bytecodeWitnessIndex:e,storageSlotsCount:a.length,salt:this.salt?(0,m.hexlify)(this.salt):b.ZeroBytes32,storageSlots:a}}getContractCreatedOutputs(){return this.outputs.filter(t=>t.type===p.OutputType.ContractCreated)}addContractCreatedOutput(t,e){this.pushOutput({type:p.OutputType.ContractCreated,contractId:t,stateRoot:e})}},P=r=>{if(r instanceof $||r instanceof U)return r;switch(r.type){case p.TransactionType.Script:return $.from(r);case p.TransactionType.Create:return U.from(r);default:throw new Error(`Unknown transaction type: ${r.type}`)}};var xt=require("@ethersproject/bytes"),Y=require("@fuel-ts/math"),R=require("@fuel-ts/transactions");var Qe=5e3,Fe=1e3,Dt=r=>{let t=new R.ReceiptCoder().decode((0,xt.arrayify)(r.rawPayload),0)[0];switch(t.type){case R.ReceiptType.ReturnData:return{...t,data:r.data};case R.ReceiptType.LogData:return{...t,data:r.data};default:return t}},E=class{id;provider;gasUsed=(0,Y.bn)(0);attempts=0;constructor(t,e){this.id=t,this.provider=e}async fetch(){let{transaction:t}=await this.provider.operations.getTransactionWithReceipts({transactionId:this.id});return t}decodeTransaction(t){var e;return(e=new R.TransactionCoder().decode((0,xt.arrayify)(t.rawPayload),0))==null?void 0:e[0]}async waitForResult(){var e,a;let t=await this.fetch();switch((e=t==null?void 0:t.status)==null?void 0:e.type){case void 0:case"SubmittedStatus":return this.attempts+=1,await dt(Math.min(Fe*this.attempts,Qe)),this.waitForResult();case"FailureStatus":{let s=t.receipts.map(Dt),{gasUsed:n,fee:i}=_({receipts:s,gasPrice:(0,Y.bn)(t==null?void 0:t.gasPrice)});return this.gasUsed=n,{status:{type:"failure",reason:t.status.reason},receipts:s,transactionId:this.id,blockId:t.status.block.id,time:t.status.time,gasUsed:n,fee:i,transaction:this.decodeTransaction(t)}}case"SuccessStatus":{let s=((a=t.receipts)==null?void 0:a.map(Dt))||[],{gasUsed:n,fee:i}=_({receipts:s,gasPrice:(0,Y.bn)(t==null?void 0:t.gasPrice)});return{status:{type:"success",programState:t.status.programState},receipts:s,transactionId:this.id,blockId:t.status.block.id,time:t.status.time,gasUsed:n,fee:i,transaction:this.decodeTransaction(t)}}default:throw new Error("Invalid Transaction status")}}async wait(){let t=await this.waitForResult();if(t.status.type==="failure")throw new Error(`Transaction failed: ${t.status.reason}`);return t}};var $e=10,ft=r=>{let t=new f.ReceiptCoder().decode((0,S.arrayify)(r.rawPayload),0)[0];switch(t.type){case f.ReceiptType.ReturnData:return{...t,data:r.data};case f.ReceiptType.LogData:return{...t,data:r.data};default:return t}},Ue=r=>{let{name:t,baseChainHeight:e,peerCount:a,consensusParameters:s,latestBlock:n}=r;return{name:t,baseChainHeight:(0,o.bn)(e),peerCount:a,consensusParameters:{contractMaxSize:(0,o.bn)(s.contractMaxSize),maxInputs:(0,o.bn)(s.maxInputs),maxOutputs:(0,o.bn)(s.maxOutputs),maxWitnesses:(0,o.bn)(s.maxWitnesses),maxGasPerTx:(0,o.bn)(s.maxGasPerTx),maxScriptLength:(0,o.bn)(s.maxScriptLength),maxScriptDataLength:(0,o.bn)(s.maxScriptDataLength),maxStorageSlots:(0,o.bn)(s.maxStorageSlots),maxPredicateLength:(0,o.bn)(s.maxPredicateLength),maxPredicateDataLength:(0,o.bn)(s.maxPredicateDataLength),gasPriceFactor:(0,o.bn)(s.gasPriceFactor),gasPerByte:(0,o.bn)(s.gasPerByte),maxMessageDataLength:(0,o.bn)(s.maxMessageDataLength)},latestBlock:{id:n.id,height:(0,o.bn)(n.header.height),time:n.header.time,transactions:n.transactions.map(i=>({id:i.id}))}}},Ee=r=>({minGasPrice:(0,o.bn)(r.minGasPrice),nodeVersion:r.nodeVersion}),N=class{constructor(t,e={}){this.url=t;this.options=e;this.operations=this.createOperations(t,e)}operations;createOperations(t,e={}){this.url=t;let a=new Ft.GraphQLClient(t,e.fetch?{fetch:e.fetch}:void 0);return Bt(a)}connect(t){this.operations=this.createOperations(t)}async getVersion(){let{nodeInfo:{nodeVersion:t}}=await this.operations.getVersion();return t}async getNetwork(){return Promise.resolve({name:"fuelv2",chainId:3735928559})}async getBlockNumber(){let{chain:t}=await this.operations.getChain();return(0,o.bn)(t.latestBlock.header.height,10)}async getNodeInfo(){let{nodeInfo:t}=await this.operations.getInfo();return Ee(t)}async getChain(){let{chain:t}=await this.operations.getChain();return Ue(t)}async sendTransaction(t){let e=P(t);await this.addMissingVariables(e);let a=(0,S.hexlify)(e.toTransactionBytes()),{gasUsed:s,minGasPrice:n}=await this.getTransactionCost(e,0);if((0,o.bn)(s).gt((0,o.bn)(e.gasLimit)))throw new Error(`gasLimit(${e.gasLimit}) is lower than the required (${s})`);if((0,o.bn)(n).gt((0,o.bn)(e.gasPrice)))throw new Error(`gasPrice(${e.gasPrice}) is lower than the required ${n}`);let{submit:{id:i}}=await this.operations.submit({encodedTransaction:a});return new E(i,this)}async call(t,{utxoValidation:e}={}){let a=P(t);await this.addMissingVariables(a);let s=(0,S.hexlify)(a.toTransactionBytes()),{dryRun:n}=await this.operations.dryRun({encodedTransaction:s,utxoValidation:e||!1});return{receipts:n.map(ft)}}async addMissingVariables(t){let e=0,a=0,s=0;if(t.type!==f.TransactionType.Create)do{let n=(0,S.hexlify)(t.toTransactionBytes()),{dryRun:i}=await this.operations.dryRun({encodedTransaction:n,utxoValidation:!1}),l=i.map(ft),{missingOutputVariables:u,missingOutputContractIds:d}=lt(l);if(e=u.length,a=d.length,e===0&&a===0)return;t.addVariableOutputs(e),d.forEach(({contractId:C})=>t.addContract(I.Address.fromString(C))),s+=1}while(s<$e)}async simulate(t){let e=P(t);await this.addMissingVariables(e);let a=(0,S.hexlify)(e.toTransactionBytes()),{dryRun:s}=await this.operations.dryRun({encodedTransaction:a,utxoValidation:!0});return{receipts:s.map(ft)}}async getTransactionCost(t,e=.2){let a=P((0,$t.default)(t)),{minGasPrice:s}=await this.getNodeInfo(),n=(0,o.max)(a.gasPrice,s),i=1+e;a.gasLimit=Qt.MAX_GAS_PER_TX,a.gasPrice=(0,o.bn)(0);let{receipts:l}=await this.call(a),{gasUsed:u,fee:d}=_({gasPrice:n,receipts:l,margin:i});return{minGasPrice:s,gasPrice:n,gasUsed:u,fee:d}}async getCoins(t,e,a){return(await this.operations.getCoins({first:10,...a,filter:{owner:t.toB256(),assetId:e&&(0,S.hexlify)(e)}})).coins.edges.map(i=>i.node).map(i=>({id:i.utxoId,assetId:i.assetId,amount:(0,o.bn)(i.amount),owner:I.Address.fromAddressOrString(i.owner),status:i.coinStatus,maturity:(0,o.bn)(i.maturity).toNumber(),blockCreated:(0,o.bn)(i.blockCreated)}))}async getResourcesToSpend(t,e,a){var i,l;let s={messages:((i=a==null?void 0:a.messages)==null?void 0:i.map(u=>(0,S.hexlify)(u)))||[],utxos:((l=a==null?void 0:a.utxos)==null?void 0:l.map(u=>(0,S.hexlify)(u)))||[]};return(await this.operations.getResourcesToSpend({owner:t.toB256(),queryPerAsset:e.map(A).map(({assetId:u,amount:d,max:C})=>({assetId:(0,S.hexlify)(u),amount:d.toString(10),max:C?C.toString(10):void 0})),excludedIds:s})).resourcesToSpend.flat().map(u=>it(u)?{id:u.utxoId,amount:(0,o.bn)(u.amount),status:u.coinStatus,assetId:u.assetId,owner:I.Address.fromAddressOrString(u.owner),maturity:(0,o.bn)(u.maturity).toNumber(),blockCreated:(0,o.bn)(u.blockCreated)}:{sender:I.Address.fromAddressOrString(u.sender),recipient:I.Address.fromAddressOrString(u.recipient),nonce:(0,o.bn)(u.nonce),amount:(0,o.bn)(u.amount),data:f.InputMessageCoder.decodeData(u.data),status:u.messageStatus,daHeight:(0,o.bn)(u.daHeight)})}async getBlock(t){let e;typeof t=="number"?e={blockHeight:(0,o.bn)(t).toString(10)}:t==="latest"?e={blockHeight:(await this.getBlockNumber()).toString(10)}:e={blockId:(0,o.bn)(t).toString(10)};let{block:a}=await this.operations.getBlock(e);return a?{id:a.id,height:(0,o.bn)(a.header.height),time:a.header.time,transactionIds:a.transactions.map(s=>s.id)}:null}async getBlockWithTransactions(t){let e;typeof t=="number"?e={blockHeight:(0,o.bn)(t).toString(10)}:t==="latest"?e={blockHeight:(await this.getBlockNumber()).toString()}:e={blockId:t};let{block:a}=await this.operations.getBlockWithTransactions(e);return a?{id:a.id,height:(0,o.bn)(a.header.height,10),time:a.header.time,transactionIds:a.transactions.map(s=>s.id),transactions:a.transactions.map(s=>{var n;return(n=new f.TransactionCoder().decode((0,S.arrayify)(s.rawPayload),0))==null?void 0:n[0]})}:null}async getTransaction(t){var a;let{transaction:e}=await this.operations.getTransaction({transactionId:t});return e?(a=new f.TransactionCoder().decode((0,S.arrayify)(e.rawPayload),0))==null?void 0:a[0]:null}async getContract(t){let{contract:e}=await this.operations.getContract({contractId:t});return e||null}async getContractBalance(t,e){let{contractBalance:a}=await this.operations.getContractBalance({contract:t.toB256(),asset:(0,S.hexlify)(e)});return(0,o.bn)(a.amount,10)}async getBalance(t,e){let{balance:a}=await this.operations.getBalance({owner:t.toB256(),assetId:(0,S.hexlify)(e)});return(0,o.bn)(a.amount,10)}async getBalances(t,e){return(await this.operations.getBalances({first:10,...e,filter:{owner:t.toB256()}})).balances.edges.map(n=>n.node).map(n=>({assetId:n.assetId,amount:(0,o.bn)(n.amount)}))}async getMessages(t,e){return(await this.operations.getMessages({first:10,...e,owner:t.toB256()})).messages.edges.map(n=>n.node).map(n=>({sender:I.Address.fromAddressOrString(n.sender),recipient:I.Address.fromAddressOrString(n.recipient),nonce:(0,o.bn)(n.nonce),amount:(0,o.bn)(n.amount),data:f.InputMessageCoder.decodeData(n.data),status:n.messageStatus,daHeight:(0,o.bn)(n.daHeight)}))}async getMessageProof(t,e){let a=await this.operations.getMessageProof({transactionId:t,messageId:e});return a.messageProof?{proofSet:a.messageProof.proofSet,proofIndex:(0,o.bn)(a.messageProof.proofIndex),sender:I.Address.fromAddressOrString(a.messageProof.sender),recipient:I.Address.fromAddressOrString(a.messageProof.recipient),nonce:a.messageProof.nonce,amount:(0,o.bn)(a.messageProof.amount),data:a.messageProof.data,signature:a.messageProof.signature,header:{id:a.messageProof.header.id,daHeight:(0,o.bn)(a.messageProof.header.daHeight),transactionsCount:(0,o.bn)(a.messageProof.header.transactionsCount),outputMessagesCount:(0,o.bn)(a.messageProof.header.outputMessagesCount),transactionsRoot:a.messageProof.header.transactionsRoot,outputMessagesRoot:a.messageProof.header.outputMessagesRoot,height:(0,o.bn)(a.messageProof.header.height),prevRoot:a.messageProof.header.prevRoot,time:a.messageProof.header.time,applicationHash:a.messageProof.header.applicationHash}}:null}};var Ut=require("@fuel-ts/abi-coder"),It=require("@fuel-ts/transactions");function Ne(r,t){return r.reduce((e,a)=>a.type===It.ReceiptType.LogData?e.concat(...t.decodeLog(a.data,a.val1.toNumber(),a.id)):a.type===It.ReceiptType.Log?e.concat(...t.decodeLog(new Ut.U64Coder().encode(a.val0),a.val1.toNumber(),a.id)):e,[])}0&&(module.exports={ChangeOutputCollisionError,CoinStatus,CreateTransactionRequest,MessageStatus,NoWitnessAtIndexError,NoWitnessByOwnerError,Provider,ScriptTransactionRequest,TransactionResponse,TransactionType,buildBlockExplorerUrl,calculatePriceWithFactor,calculateTransactionFee,coinQuantityfy,getDecodedLogs,getGasUsedFromReceipts,getReceiptsWithMissingData,inputify,isCoin,isMessage,isRawCoin,isRawMessage,normalizeJSON,outputify,returnZeroScript,sleep,transactionRequestify,withdrawScript});
//# sourceMappingURL=index.js.map